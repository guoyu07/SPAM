<!doctype html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>DataView</title>
    <link rel="stylesheet" href="../../touch-1.0.2/resources/css/sencha-touch.css" type="text/css">
    <script type="text/javascript" src="../../touch-1.0.2/sencha-touch.js"></script>
    <style type="text/css">
        .emplWrap {
            border: 1px #999999 solid;
            margin : 3px;
            height : 40px;
            -moz-border-radius: 5px;
            -webkit-border-radius: 5px;
            background-color: #ffffcc;
            padding-bottom: 3px;
        }

        .emplSelected {
            border: 1px #66ff66 solid;
            background-color: #ccffcc;
            cursor: pointer;
        }

        .emplOver {
            border: 1px #999999 dashed;
            background-color: #ccccff;
            cursor: pointer;
        }

        .emplName {
            font-weight: bold;
            margin-left: 5px;
            font-size: 1.5em;
            color: #333333;
        }

        .title {
            margin-left: 5px;
            font-weight: bold;
        }
    </style>


<script type="text/javascript">

Ext.setup({
    onReady: function() {
        var name; // <-- used for the selection handler
        Ext.regModel('list', {
            fields : ['firstName', 'lastName']
        });

        var data = [
            {
                firstName : 'Jay',
                lastName  : 'Garcia'
            },
            {
                firstName : 'Anthony',
                lastName  : 'DeMoss'
            },
            {
                firstName : 'Sebastian',
                lastName  : 'Stirling'
            },
            {
                firstName : 'Michael',
                lastName  : 'Stephens'
            },
            {
                firstName : 'Marjan',
                lastName  : 'Bace'
            },
            {
                firstName : 'Blaise',
                lastName  : 'Bace'
            },
            {
                firstName : 'Mitchell',
                lastName  : 'Simoens'
            },
            {
                firstName : 'Mary',
                lastName  : 'Piergies'
            },
            {
                firstName : 'Troy',
                lastName  : 'Mott'
            },
            {
                firstName : 'Maureen',
                lastName  : 'Spencer'
            },
            {
                firstName : 'Candace',
                lastName  : 'Gilhooley'
            },
            {
                firstName : 'Christina',
                lastName  : 'Rudloff'
            }

        ];
        var store = new Ext.data.JsonStore({
            model    : 'list',
            data     : data,
            autoLoad : true
        });

        var autoDestroyListener = {
            hide : function(sheet) {
                sheet.destroy();
            }
        };

        var showActionSheet = function(rec) {
            new Ext.ActionSheet({
                listeners : autoDestroyListener,
                defaults  : {
                    handler : function() {
                        this.ownerCt.hide();
                    }
                },
                items : [
                    {
                        xtype  : 'box',
                        height : 70,
                        style  : 'color: #FFF; text-align: center; font-size: 1.2em;',
                        html   : 'Shall we invite ' + rec.get('firstName') + ' ' + rec.get('lastName') +  '?'
                    },
                    {
                        text : 'Invite to party',
                        ui   : 'confirm'
                    },
                    {
                        text : 'Meh, never mind!',
                        ui   : 'decline'
                    }
                ]

            }).show();
        };


        var employeeDvTpl = new Ext.XTemplate(
            '<tpl for=".">',
                '<div class="emplWrap" id="employee_{id}">',
                    '<div class="emplName">{lastName}, {firstName}</div>',
                '</div>',
             '</tpl>'
        );

        var topDock = {
            xtype : 'toolbar',
            dock  : 'top',
            title : 'A simple DataView'
        };

        var myPanel = new Ext.Panel({
            fullscreen  : true,
            layout      : 'fit',
            dockedItems : [
                topDock
            ],
            items : [
                {
                    xtype           : 'dataview',
                    store           : store,
                    tpl             : employeeDvTpl,
                    singleSelect    : true,
                    selectedItemCls : 'emplSelected',
                    itemSelector    : 'div.emplWrap',
                    listeners       : {
                        itemtap : function(thisView, idx) {
                            var rec = thisView.store.getAt(idx);
                            showActionSheet(rec);

                            // delay the deselection because Sencha Touch's dataView has its own setTimeout (not cool)
                            Ext.defer(function() {
                                thisView.deselect(idx);
                            }, 100);

                        }
                    }
                }
            ]
        });
    }
});

</script>

</head>
<body></body>
</html>
