<!doctype html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Lists</title>
    <link rel="stylesheet" href="../../touch-1.0.2/resources/css/sencha-touch.css" type="text/css">
    <script type="text/javascript" src="../../touch-1.0.2/sencha-touch.js"></script>

<script type="text/javascript">

Ext.setup({
    onReady: function() {
        var name; // <-- used for the selection handler
        Ext.regModel('list', {
            fields : ['firstName']
        });


        var data = [
            {
                firstName : 'Jay',
                lastName  : 'Garcia'
            },
            {
                firstName : 'Anthony',
                lastName  : 'DeMoss'
            },
            {
                firstName : 'Sebastian',
                lastName  : 'Stirling'
            },
            {
                firstName : 'Michael',
                lastName  : 'Stephens'
            },
            {
                firstName : 'Marjan',
                lastName  : 'Bace'
            },
            {
                firstName : 'Blaise',
                lastName  : 'Bace'
            },
            {
                firstName : 'Mitchell',
                lastName  : 'Simoens'
            },
            {
                firstName : 'Mary',
                lastName  : 'Piergies'
            },
            {
                firstName : 'Troy',
                lastName  : 'Mott'
            },
            {
                firstName : 'Maureen',
                lastName  : 'Spencer'
            },
            {
                firstName : 'Candace',
                lastName  : 'Gilhooley'
            },
            {
                firstName : 'Christina',
                lastName  : 'Rudloff'
            }

        ];

        var store = new Ext.data.JsonStore({
            model    : 'list',
            data     : data,
            autoLoad : true
        });

        var topDock = {
            xtype   : 'toolbar',
            dock    : 'top',
            title   : 'A simple List view',
            buttons : [
                {
                    ui   : 'back',
                    text : "Back"
                }
            ]
        };



        var autoDestroyListener = {
            hide : function(sheet) {
                sheet.destroy();
            }
        };

        var showActionSheet = function(rec) {
            new Ext.ActionSheet({
                listeners : autoDestroyListener,
                defaults  : {
                    handler : function() {
                        this.ownerCt.hide();
                    }
                },
                items : [
                    {
                        xtype  : 'box',
                        height : 70,
                        style  : 'color: #FFF; text-align: center; font-size: 1.2em;',
                        html   : 'Shall we invite ' + rec.get('firstName') + ' ' + rec.get('lastName') +  '?'
                    },
                    {
                        text : 'Invite to party',
                        ui   : 'confirm'
                    },
                    {
                        text : 'Meh, never mind!',
                        ui   : 'decline'
                    }
                ]
            }).show();
        };


        var myPanel = new Ext.Panel({
            fullscreen  : true,
            dockedItems : [
                topDock
            ],
            layout : 'fit',
            items  : [
                {
                    xtype     : 'list',
                    store     : store,
                    itemTpl   : '{lastName}, {firstName}' ,
                    listeners : {
                        itemtap : function(thisView, idx) {
                            var rec = thisView.store.getAt(idx);
                            showActionSheet(rec);

                            // delay the deselection because Sencha Touch's dataView has its own setTimeout (not cool)
                            Ext.defer(function() {
                                thisView.deselect(idx);
                            }, 100);

                        }
                    }
                }
            ]
        });
    }
});

</script>

</head>
<body></body>
</html>
